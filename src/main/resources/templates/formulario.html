<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Panel Cliente</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        form { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; }
        h2 { margin-top: 0; }
        label { display: inline-block; width: 200px; }
        input, textarea, select { width: 300px; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
<h1>Panel Cliente</h1>

<!-- Buscar Usuarios -->
<form id="buscarUsuariosForm">
    <h2>Buscar Usuarios</h2>
    <label for="subcadenaUsuarios">Nombre o parte del nombre:</label>
    <input type="text" id="subcadenaUsuarios" name="subcadena" placeholder="Ingresa subcadena" required>
    <button type="submit">Buscar Usuarios</button>
</form>

<!-- Buscar Textos -->
<form id="buscarTextosForm">
    <h2>Buscar Textos</h2>
    <label for="subcadenaTextos">Título o contenido:</label>
    <input type="text" id="subcadenaTextos" name="subcadena" placeholder="Ingresa subcadena" required>
    <button type="submit">Buscar Textos</button>
</form>

<!-- Crear Usuario -->
<form id="crearUsuarioForm">
    <h2>Crear Usuario</h2>
    <label for="nombre">Nombre:</label>
    <input type="text" id="nombre" name="nombre" required><br>

    <label for="apellido">Apellido:</label>
    <input type="text" id="apellido" name="apellido" required><br>

    <label for="alias">Alias:</label>
    <input type="text" id="alias" name="alias"><br>

    <label for="email">Email:</label>
    <input type="email" id="email" name="email" required><br>

    <label for="password">Password:</label>
    <input type="password" id="password" name="password" required><br>

    <label for="fechaNac">Fecha de Nacimiento (yyyy-MM-dd):</label>
    <input type="text" id="fechaNac" name="fechaNac" required><br>

    <button type="submit">Crear Usuario</button>
</form>

<!-- Actualizar Usuario -->
<form id="actualizarUsuarioForm">
    <h2>Actualizar Usuario</h2>
    <label for="idUsuarioUpdate">ID Usuario:</label>
    <input type="number" id="idUsuarioUpdate" name="idUsuario" required><br>

    <label for="aliasUpdate">Nuevo Alias:</label>
    <input type="text" id="aliasUpdate" name="alias"><br>

    <label for="emailUpdate">Nuevo Email:</label>
    <input type="email" id="emailUpdate" name="email"><br>

    <label for="passwordUpdate">Nueva Password:</label>
    <input type="password" id="passwordUpdate" name="password"><br>

    <label for="fechaNacUpdate">Nueva Fecha de Nac (yyyy-MM-dd):</label>
    <input type="text" id="fechaNacUpdate" name="fechaNac"><br>

    <label for="sexoUpdate">Sexo:</label>
    <input type="text" id="sexoUpdate" name="sexo"><br>

    <label for="ciudadUpdate">Ciudad:</label>
    <input type="text" id="ciudadUpdate" name="ciudad"><br>

    <label for="avatarURLUpdate">Avatar URL:</label>
    <input type="text" id="avatarURLUpdate" name="avatarURL"><br>

    <button type="submit">Actualizar Usuario</button>
</form>

<!-- Eliminar Usuario (Borrado Blando) -->
<form id="eliminarUsuarioForm">
    <h2>Eliminar Usuario</h2>
    <label for="idUsuarioDelete">ID Usuario:</label>
    <input type="number" id="idUsuarioDelete" name="idUsuario" required><br>

    <button type="submit">Eliminar Usuario</button>
</form>

<!-- Crear Texto -->
<form id="crearTextoForm">
    <h2>Crear Texto</h2>
    <label for="idAutor">ID Autor:</label>
    <input type="number" id="idAutor" name="idAutor" required><br>

    <label for="titulo">Título:</label>
    <input type="text" id="titulo" name="titulo" required><br>

    <label for="contenido">Contenido:</label>
    <textarea id="contenido" name="contenido" required></textarea><br>

    <label for="estado">Estado:</label>
    <input type="text" id="estado" name="estado" required><br>

    <!-- Opcional -->
    <label for="categoria">Categoría:</label>
    <input type="text" id="categoria" name="categoria"><br>

    <label for="subcategoria">Subcategoría:</label>
    <input type="text" id="subcategoria" name="subcategoria"><br>

    <label for="idioma">Idioma:</label>
    <input type="text" id="idioma" name="idioma"><br>

    <label for="sinopsis">Sinopsis:</label>
    <textarea id="sinopsis" name="sinopsis"></textarea><br>

    <button type="submit">Crear Texto</button>
</form>

<!-- Actualizar Texto -->
<form id="actualizarTextoForm">
    <h2>Actualizar Texto</h2>
    <label for="idTextoUpdate">ID Texto:</label>
    <input type="number" id="idTextoUpdate" name="idTexto" required><br>

    <label for="tituloUpdate">Nuevo Título:</label>
    <input type="text" id="tituloUpdate" name="titulo"><br>

    <label for="estadoUpdate">Nuevo Estado:</label>
    <input type="text" id="estadoUpdate" name="estado"><br>

    <label for="categoriaUpdate">Categoría:</label>
    <input type="text" id="categoriaUpdate" name="categoria"><br>

    <label for="subcategoriaUpdate">Subcategoría:</label>
    <input type="text" id="subcategoriaUpdate" name="subcategoria"><br>

    <label for="idiomaUpdate">Idioma:</label>
    <input type="text" id="idiomaUpdate" name="idioma"><br>

    <label for="sinopsisUpdate">Sinopsis:</label>
    <textarea id="sinopsisUpdate" name="sinopsis"></textarea><br>

    <label for="contenidoUpdate">Nuevo Contenido:</label>
    <textarea id="contenidoUpdate" name="contenido"></textarea><br>

    <button type="submit">Actualizar Texto</button>
</form>

<!-- Eliminar Texto -->
<form id="eliminarTextoForm">
    <h2>Eliminar Texto</h2>
    <label for="idTextoDelete">ID Texto:</label>
    <input type="number" id="idTextoDelete" name="idTexto" required><br>

    <button type="submit">Eliminar Texto</button>
</form>

<!-- Resultados -->
<h2>Resultados:</h2>
<ul id="resultados"></ul>

<script>
    const BASE_URL = 'http://localhost:8080';

    // Función para mostrar resultados en pantalla.
    function mostrarResultados(data) {
        const lista = document.getElementById('resultados');
        lista.innerHTML = ''; // Limpiar resultados anteriores.

        if (Array.isArray(data)) {
            data.forEach(item => {
                const li = document.createElement('li');
                li.textContent = JSON.stringify(item, null, 2);
                lista.appendChild(li);
            });
        } else {
            const li = document.createElement('li');
            li.textContent = JSON.stringify(data, null, 2);
            lista.appendChild(li);
        }
    }

    // Buscar usuarios por subcadena.
    document.getElementById('buscarUsuariosForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const subcadena = document.getElementById('subcadenaUsuarios').value;

        fetch(`${BASE_URL}/admin/usuarios/buscar?subcadena=${encodeURIComponent(subcadena)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('No se han encontrado usuarios.');
                }
                return response.json();
            })
            .then(data => {
                mostrarResultados(data);
                this.reset(); // Opcional: limpiar el formulario.
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al buscar usuarios: \n' + error.message);
            });
    });

    // Buscar textos por subcadena.
    document.getElementById('buscarTextosForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const subcadena = document.getElementById('subcadenaTextos').value.trim();

        fetch(`${BASE_URL}/textos/buscar?subcadena=${encodeURIComponent(subcadena)}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('No se encontraron coincidencias.');
                }
                return response.json();
            })
            .then(data => {
                mostrarResultados(data);
                this.reset(); // Opcional: limpiar el formulario.
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al buscar textos: \n' + error.message);
            });
    });

    // Crear Usuario.
    document.getElementById('crearUsuarioForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new URLSearchParams(new FormData(this));

        fetch(`${BASE_URL}/usuario/crear`, {
            method: 'POST',
            body: formData // ¡Los datos van aquí, en el objeto de configuración!
        })
            .then(response => { // ¡Aquí empiezan las promesas!
                if (!response.ok) {
                    // Si la respuesta no es OK, leer el texto del error
                    return response.text().then(text => {
                        throw new Error(text); // Lanzar el error para el catch
                    });
                }
                return response.json(); // Si es OK, parsear como JSON
            })
            .then(data => {
                alert('Usuario creado con éxito.');
                mostrarResultados(data);
                this.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al crear usuario: \n' + error.message);
            });
    });

    // Actualizar Usuario
    document.getElementById('actualizarUsuarioForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new URLSearchParams(new FormData(this));

        fetch(`${BASE_URL}/usuario/actualizar`, {
            method: 'PUT',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                alert('Usuario actualizado con éxito.');
                mostrarResultados(data);
                this.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al actualizar usuario: \n' + error.message);
            });
    });

    // Eliminar Usuario
    document.getElementById('eliminarUsuarioForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const idUsuario = document.getElementById('idUsuarioDelete').value;

        fetch(`${BASE_URL}/usuario/${idUsuario}`, {
            method: 'PUT'
        })
            .then(response => response.text())
            .then(message => {
                alert(message);
                this.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al eliminar usuario: \n' + error.message);
            });
    });

    // Crear Texto
    document.getElementById('crearTextoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new URLSearchParams(new FormData(this));

        fetch(`${BASE_URL}/texto/crear`, {
            method: 'POST',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                alert('Texto creado con éxito.');
                mostrarResultados(data);
                this.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al crear texto: \n' + error.message);
            });
    });

    // Actualizar Texto
    document.getElementById('actualizarTextoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new URLSearchParams(new FormData(this));

        fetch(`${BASE_URL}/texto/actualizar`, {
            method: 'PUT',
            body: formData
        })
            .then(response => response.json())
            .then(data => {
                alert('Texto actualizado con éxito.');
                mostrarResultados(data);
                this.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al actualizar texto: \n' + error.message);
            });
    });

    // Eliminar Texto
    document.getElementById('eliminarTextoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const idTexto = document.getElementById('idTextoDelete').value;

        fetch(`${BASE_URL}/texto/${idTexto}`, {
            method: 'PUT'
        })
            .then(response => response.text())
            .then(message => {
                alert(message);
                this.reset();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error al eliminar texto: \n' + error.message);
            });
    });
</script>
</body>
</html>